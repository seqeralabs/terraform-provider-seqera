// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"encoding/json"
	"github.com/hashicorp/terraform-plugin-framework-jsontypes/jsontypes"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/seqeralabs/terraform-provider-seqera/internal/provider/typeconvert"
	tfTypes "github.com/seqeralabs/terraform-provider-seqera/internal/provider/types"
	"github.com/seqeralabs/terraform-provider-seqera/internal/sdk/models/operations"
	"github.com/seqeralabs/terraform-provider-seqera/internal/sdk/models/shared"
)

func (r *WorkflowsResourceModel) RefreshFromSharedDescribeWorkflowResponse(ctx context.Context, resp *shared.DescribeWorkflowResponse) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		if resp.Workflow == nil {
			r.Workflow = nil
		} else {
			r.Workflow = &tfTypes.Workflow{}
			r.Workflow.CommandLine = types.StringValue(resp.Workflow.CommandLine)
			r.Workflow.CommitID = types.StringPointerValue(resp.Workflow.CommitID)
			r.Workflow.Complete = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.Workflow.Complete))
			r.Workflow.ConfigFiles = make([]types.String, 0, len(resp.Workflow.ConfigFiles))
			for _, v := range resp.Workflow.ConfigFiles {
				r.Workflow.ConfigFiles = append(r.Workflow.ConfigFiles, types.StringValue(v))
			}
			r.Workflow.ConfigText = types.StringPointerValue(resp.Workflow.ConfigText)
			r.Workflow.Container = types.StringPointerValue(resp.Workflow.Container)
			r.Workflow.ContainerEngine = types.StringPointerValue(resp.Workflow.ContainerEngine)
			r.Workflow.DateCreated = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.Workflow.DateCreated))
			r.Workflow.Deleted = types.BoolPointerValue(resp.Workflow.Deleted)
			r.Workflow.Duration = types.Int64PointerValue(resp.Workflow.Duration)
			r.Workflow.ErrorMessage = types.StringPointerValue(resp.Workflow.ErrorMessage)
			r.Workflow.ErrorReport = types.StringPointerValue(resp.Workflow.ErrorReport)
			r.Workflow.ExitStatus = types.Int32PointerValue(typeconvert.IntPointerToInt32Pointer(resp.Workflow.ExitStatus))
			r.Workflow.HomeDir = types.StringPointerValue(resp.Workflow.HomeDir)
			r.Workflow.ID = types.StringPointerValue(resp.Workflow.ID)
			r.Workflow.LastUpdated = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.Workflow.LastUpdated))
			r.Workflow.LaunchDir = types.StringPointerValue(resp.Workflow.LaunchDir)
			r.Workflow.LaunchID = types.StringPointerValue(resp.Workflow.LaunchID)
			r.Workflow.LogFile = types.StringPointerValue(resp.Workflow.LogFile)
			if resp.Workflow.Manifest == nil {
				r.Workflow.Manifest = nil
			} else {
				r.Workflow.Manifest = &tfTypes.WfManifest{}
				r.Workflow.Manifest.Author = types.StringPointerValue(resp.Workflow.Manifest.Author)
				r.Workflow.Manifest.DefaultBranch = types.StringPointerValue(resp.Workflow.Manifest.DefaultBranch)
				r.Workflow.Manifest.Description = types.StringPointerValue(resp.Workflow.Manifest.Description)
				r.Workflow.Manifest.Gitmodules = types.StringPointerValue(resp.Workflow.Manifest.Gitmodules)
				r.Workflow.Manifest.HomePage = types.StringPointerValue(resp.Workflow.Manifest.HomePage)
				r.Workflow.Manifest.Icon = types.StringPointerValue(resp.Workflow.Manifest.Icon)
				r.Workflow.Manifest.MainScript = types.StringPointerValue(resp.Workflow.Manifest.MainScript)
				r.Workflow.Manifest.Name = types.StringPointerValue(resp.Workflow.Manifest.Name)
				r.Workflow.Manifest.NextflowVersion = types.StringPointerValue(resp.Workflow.Manifest.NextflowVersion)
				r.Workflow.Manifest.Version = types.StringPointerValue(resp.Workflow.Manifest.Version)
			}
			if resp.Workflow.Nextflow == nil {
				r.Workflow.Nextflow = nil
			} else {
				r.Workflow.Nextflow = &tfTypes.WfNextflow{}
				r.Workflow.Nextflow.Build = types.StringPointerValue(resp.Workflow.Nextflow.Build)
				r.Workflow.Nextflow.Timestamp = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.Workflow.Nextflow.Timestamp))
				r.Workflow.Nextflow.Version = types.StringPointerValue(resp.Workflow.Nextflow.Version)
			}
			r.Workflow.OperationID = types.StringPointerValue(resp.Workflow.OperationID)
			r.Workflow.OutFile = types.StringPointerValue(resp.Workflow.OutFile)
			r.Workflow.OwnerID = types.Int64PointerValue(resp.Workflow.OwnerID)
			if len(resp.Workflow.Params) > 0 {
				r.Workflow.Params = make(map[string]jsontypes.Normalized, len(resp.Workflow.Params))
				for key, value := range resp.Workflow.Params {
					result, _ := json.Marshal(value)
					r.Workflow.Params[key] = jsontypes.NewNormalizedValue(string(result))
				}
			}
			r.Workflow.Profile = types.StringPointerValue(resp.Workflow.Profile)
			r.Workflow.ProjectDir = types.StringPointerValue(resp.Workflow.ProjectDir)
			r.Workflow.ProjectName = types.StringValue(resp.Workflow.ProjectName)
			r.Workflow.Repository = types.StringPointerValue(resp.Workflow.Repository)
			r.Workflow.RequiresAttention = types.BoolPointerValue(resp.Workflow.RequiresAttention)
			r.Workflow.Resume = types.BoolPointerValue(resp.Workflow.Resume)
			r.Workflow.Revision = types.StringPointerValue(resp.Workflow.Revision)
			r.Workflow.RunName = types.StringValue(resp.Workflow.RunName)
			r.Workflow.ScriptFile = types.StringPointerValue(resp.Workflow.ScriptFile)
			r.Workflow.ScriptID = types.StringPointerValue(resp.Workflow.ScriptID)
			r.Workflow.ScriptName = types.StringPointerValue(resp.Workflow.ScriptName)
			r.Workflow.SessionID = types.StringValue(resp.Workflow.SessionID)
			r.Workflow.Start = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.Workflow.Start))
			if resp.Workflow.Stats == nil {
				r.Workflow.Stats = nil
			} else {
				r.Workflow.Stats = &tfTypes.WfStats{}
				r.Workflow.Stats.CachedCount = types.Int32PointerValue(typeconvert.IntPointerToInt32Pointer(resp.Workflow.Stats.CachedCount))
				r.Workflow.Stats.CachedCountFmt = types.StringPointerValue(resp.Workflow.Stats.CachedCountFmt)
				r.Workflow.Stats.CachedDuration = types.Int64PointerValue(resp.Workflow.Stats.CachedDuration)
				r.Workflow.Stats.CachedPct = types.Float32PointerValue(resp.Workflow.Stats.CachedPct)
				r.Workflow.Stats.ComputeTimeFmt = types.StringPointerValue(resp.Workflow.Stats.ComputeTimeFmt)
				r.Workflow.Stats.FailedCount = types.Int32PointerValue(typeconvert.IntPointerToInt32Pointer(resp.Workflow.Stats.FailedCount))
				r.Workflow.Stats.FailedCountFmt = types.StringPointerValue(resp.Workflow.Stats.FailedCountFmt)
				r.Workflow.Stats.FailedDuration = types.Int64PointerValue(resp.Workflow.Stats.FailedDuration)
				r.Workflow.Stats.FailedPct = types.Float32PointerValue(resp.Workflow.Stats.FailedPct)
				r.Workflow.Stats.IgnoredCount = types.Int32PointerValue(typeconvert.IntPointerToInt32Pointer(resp.Workflow.Stats.IgnoredCount))
				r.Workflow.Stats.IgnoredCountFmt = types.StringPointerValue(resp.Workflow.Stats.IgnoredCountFmt)
				r.Workflow.Stats.IgnoredPct = types.Float32PointerValue(resp.Workflow.Stats.IgnoredPct)
				r.Workflow.Stats.SucceedCount = types.Int32PointerValue(typeconvert.IntPointerToInt32Pointer(resp.Workflow.Stats.SucceedCount))
				r.Workflow.Stats.SucceedCountFmt = types.StringPointerValue(resp.Workflow.Stats.SucceedCountFmt)
				r.Workflow.Stats.SucceedDuration = types.Int64PointerValue(resp.Workflow.Stats.SucceedDuration)
				r.Workflow.Stats.SucceedPct = types.Float32PointerValue(resp.Workflow.Stats.SucceedPct)
			}
			if resp.Workflow.Status != nil {
				r.Workflow.Status = types.StringValue(string(*resp.Workflow.Status))
			} else {
				r.Workflow.Status = types.StringNull()
			}
			r.Workflow.Submit = types.StringValue(typeconvert.TimeToString(resp.Workflow.Submit))
			r.Workflow.Success = types.BoolPointerValue(resp.Workflow.Success)
			r.Workflow.UserName = types.StringValue(resp.Workflow.UserName)
			r.Workflow.WorkDir = types.StringValue(resp.Workflow.WorkDir)
		}
		r.WorkspaceID = types.Int64PointerValue(resp.WorkspaceID)
	}

	return diags
}

func (r *WorkflowsResourceModel) RefreshFromSharedSubmitWorkflowLaunchResponse(ctx context.Context, resp *shared.SubmitWorkflowLaunchResponse) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		r.WorkflowID = types.StringPointerValue(resp.WorkflowID)
	}

	return diags
}

func (r *WorkflowsResourceModel) ToOperationsCreateWorkflowLaunchRequest(ctx context.Context) (*operations.CreateWorkflowLaunchRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var workspaceID int64
	workspaceID = r.WorkspaceID.ValueInt64()

	sourceWorkspaceID := new(int64)
	if !r.SourceWorkspaceID.IsUnknown() && !r.SourceWorkspaceID.IsNull() {
		*sourceWorkspaceID = r.SourceWorkspaceID.ValueInt64()
	} else {
		sourceWorkspaceID = nil
	}
	submitWorkflowLaunchRequest, submitWorkflowLaunchRequestDiags := r.ToSharedSubmitWorkflowLaunchRequest(ctx)
	diags.Append(submitWorkflowLaunchRequestDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.CreateWorkflowLaunchRequest{
		WorkspaceID:                 workspaceID,
		SourceWorkspaceID:           sourceWorkspaceID,
		SubmitWorkflowLaunchRequest: *submitWorkflowLaunchRequest,
	}

	return &out, diags
}

func (r *WorkflowsResourceModel) ToOperationsDeleteWorkflowRequest(ctx context.Context) (*operations.DeleteWorkflowRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var workflowID string
	workflowID = r.WorkflowID.ValueString()

	workspaceID := new(int64)
	if !r.WorkspaceID.IsUnknown() && !r.WorkspaceID.IsNull() {
		*workspaceID = r.WorkspaceID.ValueInt64()
	} else {
		workspaceID = nil
	}
	force := new(bool)
	if !r.Force.IsUnknown() && !r.Force.IsNull() {
		*force = r.Force.ValueBool()
	} else {
		force = nil
	}
	out := operations.DeleteWorkflowRequest{
		WorkflowID:  workflowID,
		WorkspaceID: workspaceID,
		Force:       force,
	}

	return &out, diags
}

func (r *WorkflowsResourceModel) ToOperationsDescribeWorkflowRequest(ctx context.Context) (*operations.DescribeWorkflowRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var workflowID string
	workflowID = r.WorkflowID.ValueString()

	workspaceID := new(int64)
	if !r.WorkspaceID.IsUnknown() && !r.WorkspaceID.IsNull() {
		*workspaceID = r.WorkspaceID.ValueInt64()
	} else {
		workspaceID = nil
	}
	out := operations.DescribeWorkflowRequest{
		WorkflowID:  workflowID,
		WorkspaceID: workspaceID,
	}

	return &out, diags
}

func (r *WorkflowsResourceModel) ToSharedSubmitWorkflowLaunchRequest(ctx context.Context) (*shared.SubmitWorkflowLaunchRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	launch, launchDiags := r.ToSharedWorkflowLaunchRequest(ctx)
	diags.Append(launchDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := shared.SubmitWorkflowLaunchRequest{
		Launch: *launch,
	}

	return &out, diags
}

func (r *WorkflowsResourceModel) ToSharedWorkflowLaunchRequest(ctx context.Context) (*shared.WorkflowLaunchRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	computeEnvID := new(string)
	if !r.ComputeEnvID.IsUnknown() && !r.ComputeEnvID.IsNull() {
		*computeEnvID = r.ComputeEnvID.ValueString()
	} else {
		computeEnvID = nil
	}
	runName := new(string)
	if !r.RunName.IsUnknown() && !r.RunName.IsNull() {
		*runName = r.RunName.ValueString()
	} else {
		runName = nil
	}
	pipeline := new(string)
	if !r.Pipeline.IsUnknown() && !r.Pipeline.IsNull() {
		*pipeline = r.Pipeline.ValueString()
	} else {
		pipeline = nil
	}
	var workDir string
	workDir = r.WorkDir.ValueString()

	revision := new(string)
	if !r.Revision.IsUnknown() && !r.Revision.IsNull() {
		*revision = r.Revision.ValueString()
	} else {
		revision = nil
	}
	configProfiles := make([]string, 0, len(r.ConfigProfiles))
	for _, configProfilesItem := range r.ConfigProfiles {
		configProfiles = append(configProfiles, configProfilesItem.ValueString())
	}
	userSecrets := make([]string, 0, len(r.UserSecrets))
	for _, userSecretsItem := range r.UserSecrets {
		userSecrets = append(userSecrets, userSecretsItem.ValueString())
	}
	workspaceSecrets := make([]string, 0, len(r.WorkspaceSecrets))
	for _, workspaceSecretsItem := range r.WorkspaceSecrets {
		workspaceSecrets = append(workspaceSecrets, workspaceSecretsItem.ValueString())
	}
	configText := new(string)
	if !r.ConfigText.IsUnknown() && !r.ConfigText.IsNull() {
		*configText = r.ConfigText.ValueString()
	} else {
		configText = nil
	}
	towerConfig := new(string)
	if !r.TowerConfig.IsUnknown() && !r.TowerConfig.IsNull() {
		*towerConfig = r.TowerConfig.ValueString()
	} else {
		towerConfig = nil
	}
	paramsText := new(string)
	if !r.ParamsText.IsUnknown() && !r.ParamsText.IsNull() {
		*paramsText = r.ParamsText.ValueString()
	} else {
		paramsText = nil
	}
	preRunScript := new(string)
	if !r.PreRunScript.IsUnknown() && !r.PreRunScript.IsNull() {
		*preRunScript = r.PreRunScript.ValueString()
	} else {
		preRunScript = nil
	}
	postRunScript := new(string)
	if !r.PostRunScript.IsUnknown() && !r.PostRunScript.IsNull() {
		*postRunScript = r.PostRunScript.ValueString()
	} else {
		postRunScript = nil
	}
	mainScript := new(string)
	if !r.MainScript.IsUnknown() && !r.MainScript.IsNull() {
		*mainScript = r.MainScript.ValueString()
	} else {
		mainScript = nil
	}
	entryName := new(string)
	if !r.EntryName.IsUnknown() && !r.EntryName.IsNull() {
		*entryName = r.EntryName.ValueString()
	} else {
		entryName = nil
	}
	schemaName := new(string)
	if !r.SchemaName.IsUnknown() && !r.SchemaName.IsNull() {
		*schemaName = r.SchemaName.ValueString()
	} else {
		schemaName = nil
	}
	resume := new(bool)
	if !r.Resume.IsUnknown() && !r.Resume.IsNull() {
		*resume = r.Resume.ValueBool()
	} else {
		resume = nil
	}
	pullLatest := new(bool)
	if !r.PullLatest.IsUnknown() && !r.PullLatest.IsNull() {
		*pullLatest = r.PullLatest.ValueBool()
	} else {
		pullLatest = nil
	}
	stubRun := new(bool)
	if !r.StubRun.IsUnknown() && !r.StubRun.IsNull() {
		*stubRun = r.StubRun.ValueBool()
	} else {
		stubRun = nil
	}
	labelIds := make([]int64, 0, len(r.LabelIds))
	for _, labelIdsItem := range r.LabelIds {
		labelIds = append(labelIds, labelIdsItem.ValueInt64())
	}
	headJobCpus := new(int)
	if !r.HeadJobCpus.IsUnknown() && !r.HeadJobCpus.IsNull() {
		*headJobCpus = int(r.HeadJobCpus.ValueInt32())
	} else {
		headJobCpus = nil
	}
	headJobMemoryMb := new(int)
	if !r.HeadJobMemoryMb.IsUnknown() && !r.HeadJobMemoryMb.IsNull() {
		*headJobMemoryMb = int(r.HeadJobMemoryMb.ValueInt32())
	} else {
		headJobMemoryMb = nil
	}
	out := shared.WorkflowLaunchRequest{
		ComputeEnvID:     computeEnvID,
		RunName:          runName,
		Pipeline:         pipeline,
		WorkDir:          workDir,
		Revision:         revision,
		ConfigProfiles:   configProfiles,
		UserSecrets:      userSecrets,
		WorkspaceSecrets: workspaceSecrets,
		ConfigText:       configText,
		TowerConfig:      towerConfig,
		ParamsText:       paramsText,
		PreRunScript:     preRunScript,
		PostRunScript:    postRunScript,
		MainScript:       mainScript,
		EntryName:        entryName,
		SchemaName:       schemaName,
		Resume:           resume,
		PullLatest:       pullLatest,
		StubRun:          stubRun,
		LabelIds:         labelIds,
		HeadJobCpus:      headJobCpus,
		HeadJobMemoryMb:  headJobMemoryMb,
	}

	return &out, diags
}
