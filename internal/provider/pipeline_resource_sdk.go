// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/speakeasy/terraform-provider-seqera/internal/provider/typeconvert"
	tfTypes "github.com/speakeasy/terraform-provider-seqera/internal/provider/types"
	"github.com/speakeasy/terraform-provider-seqera/internal/sdk/models/operations"
	"github.com/speakeasy/terraform-provider-seqera/internal/sdk/models/shared"
)

func (r *PipelineResourceModel) ToSharedUpdatePipelineRequest(ctx context.Context) (*shared.UpdatePipelineRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	name := new(string)
	if !r.Name.IsUnknown() && !r.Name.IsNull() {
		*name = r.Name.ValueString()
	} else {
		name = nil
	}
	description := new(string)
	if !r.Description.IsUnknown() && !r.Description.IsNull() {
		*description = r.Description.ValueString()
	} else {
		description = nil
	}
	icon := new(string)
	if !r.Icon.IsUnknown() && !r.Icon.IsNull() {
		*icon = r.Icon.ValueString()
	} else {
		icon = nil
	}
	labelIds := make([]int64, 0, len(r.LabelIds))
	for _, labelIdsItem := range r.LabelIds {
		labelIds = append(labelIds, labelIdsItem.ValueInt64())
	}
	out := shared.UpdatePipelineRequest{
		Name:        name,
		Description: description,
		Icon:        icon,
		LabelIds:    labelIds,
	}

	return &out, diags
}

func (r *PipelineResourceModel) ToOperationsUpdatePipelineRequest(ctx context.Context) (*operations.UpdatePipelineRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var pipelineID int64
	pipelineID = r.PipelineID.ValueInt64()

	workspaceID := new(int64)
	if !r.WorkspaceID.IsUnknown() && !r.WorkspaceID.IsNull() {
		*workspaceID = r.WorkspaceID.ValueInt64()
	} else {
		workspaceID = nil
	}
	updatePipelineRequest, updatePipelineRequestDiags := r.ToSharedUpdatePipelineRequest(ctx)
	diags.Append(updatePipelineRequestDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.UpdatePipelineRequest{
		PipelineID:            pipelineID,
		WorkspaceID:           workspaceID,
		UpdatePipelineRequest: *updatePipelineRequest,
	}

	return &out, diags
}

func (r *PipelineResourceModel) ToOperationsCreatePipelineRequest(ctx context.Context) (*operations.CreatePipelineRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	workspaceID := new(int64)
	if !r.WorkspaceID.IsUnknown() && !r.WorkspaceID.IsNull() {
		*workspaceID = r.WorkspaceID.ValueInt64()
	} else {
		workspaceID = nil
	}
	out := operations.CreatePipelineRequest{
		WorkspaceID: workspaceID,
	}

	return &out, diags
}

func (r *PipelineResourceModel) ToOperationsDescribePipelineRequest(ctx context.Context) (*operations.DescribePipelineRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var pipelineID int64
	pipelineID = r.PipelineID.ValueInt64()

	workspaceID := new(int64)
	if !r.WorkspaceID.IsUnknown() && !r.WorkspaceID.IsNull() {
		*workspaceID = r.WorkspaceID.ValueInt64()
	} else {
		workspaceID = nil
	}
	out := operations.DescribePipelineRequest{
		PipelineID:  pipelineID,
		WorkspaceID: workspaceID,
	}

	return &out, diags
}

func (r *PipelineResourceModel) ToOperationsDeletePipelineRequest(ctx context.Context) (*operations.DeletePipelineRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var pipelineID int64
	pipelineID = r.PipelineID.ValueInt64()

	workspaceID := new(int64)
	if !r.WorkspaceID.IsUnknown() && !r.WorkspaceID.IsNull() {
		*workspaceID = r.WorkspaceID.ValueInt64()
	} else {
		workspaceID = nil
	}
	out := operations.DeletePipelineRequest{
		PipelineID:  pipelineID,
		WorkspaceID: workspaceID,
	}

	return &out, diags
}

func (r *PipelineResourceModel) RefreshFromSharedPipelineDbDto(ctx context.Context, resp *shared.PipelineDbDto) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		rPriorData := r
		if resp.ComputeEnv == nil {
			r.ComputeEnv = nil
		} else {
			r.ComputeEnv = &tfTypes.ComputeEnvDbDto{}
			r.ComputeEnv.ID = types.StringPointerValue(resp.ComputeEnv.ID)
			r.ComputeEnv.Name = types.StringPointerValue(resp.ComputeEnv.Name)
			r.ComputeEnv.Platform = types.StringPointerValue(resp.ComputeEnv.Platform)
			r.ComputeEnv.Region = types.StringPointerValue(resp.ComputeEnv.Region)
		}
		r.ComputeEnvID = rPriorData.ComputeEnvID
		r.ConfigProfiles = rPriorData.ConfigProfiles
		r.ConfigText = rPriorData.ConfigText
		r.DateCreated = rPriorData.DateCreated
		r.Deleted = types.BoolPointerValue(resp.Deleted)
		r.Description = types.StringPointerValue(resp.Description)
		r.EntryName = rPriorData.EntryName
		r.HeadJobCpus = rPriorData.HeadJobCpus
		r.HeadJobMemoryMb = rPriorData.HeadJobMemoryMb
		r.Icon = types.StringPointerValue(resp.Icon)
		r.LabelIds = rPriorData.LabelIds
		r.Labels = []tfTypes.LabelDbDto{}
		if len(r.Labels) > len(resp.Labels) {
			r.Labels = r.Labels[:len(resp.Labels)]
		}
		for labelsCount, labelsItem := range resp.Labels {
			var labels tfTypes.LabelDbDto
			labels.DateCreated = types.StringPointerValue(typeconvert.TimePointerToStringPointer(labelsItem.DateCreated))
			labels.ID = types.Int64PointerValue(labelsItem.ID)
			labels.IsDefault = types.BoolPointerValue(labelsItem.IsDefault)
			labels.Name = types.StringPointerValue(labelsItem.Name)
			labels.Resource = types.BoolPointerValue(labelsItem.Resource)
			labels.Value = types.StringPointerValue(labelsItem.Value)
			if labelsCount+1 > len(r.Labels) {
				r.Labels = append(r.Labels, labels)
			} else {
				r.Labels[labelsCount].DateCreated = labels.DateCreated
				r.Labels[labelsCount].ID = labels.ID
				r.Labels[labelsCount].IsDefault = labels.IsDefault
				r.Labels[labelsCount].Name = labels.Name
				r.Labels[labelsCount].Resource = labels.Resource
				r.Labels[labelsCount].Value = labels.Value
			}
		}
		r.LastUpdated = types.StringPointerValue(typeconvert.TimePointerToStringPointer(resp.LastUpdated))
		r.LaunchContainer = rPriorData.LaunchContainer
		r.MainScript = rPriorData.MainScript
		r.Name = types.StringPointerValue(resp.Name)
		r.OptimizationID = types.StringPointerValue(resp.OptimizationID)
		if resp.OptimizationStatus != nil {
			r.OptimizationStatus = types.StringValue(string(*resp.OptimizationStatus))
		} else {
			r.OptimizationStatus = types.StringNull()
		}
		r.OptimizationTargets = types.StringPointerValue(resp.OptimizationTargets)
		r.OrgID = types.Int64PointerValue(resp.OrgID)
		r.OrgName = types.StringPointerValue(resp.OrgName)
		r.ParamsText = rPriorData.ParamsText
		r.Pipeline = rPriorData.Pipeline
		r.PipelineID = types.Int64PointerValue(resp.PipelineID)
		r.PostRunScript = rPriorData.PostRunScript
		r.PreRunScript = rPriorData.PreRunScript
		r.PullLatest = rPriorData.PullLatest
		r.Repository = types.StringPointerValue(resp.Repository)
		r.Resume = rPriorData.Resume
		r.Revision = rPriorData.Revision
		r.RunName = rPriorData.RunName
		r.SchemaName = rPriorData.SchemaName
		r.SessionID = rPriorData.SessionID
		r.StubRun = rPriorData.StubRun
		r.TowerConfig = rPriorData.TowerConfig
		r.UserFirstName = types.StringPointerValue(resp.UserFirstName)
		r.UserID = types.Int64PointerValue(resp.UserID)
		r.UserLastName = types.StringPointerValue(resp.UserLastName)
		r.UserName = types.StringPointerValue(resp.UserName)
		r.UserSecrets = rPriorData.UserSecrets
		r.Visibility = types.StringPointerValue(resp.Visibility)
		r.WorkDir = rPriorData.WorkDir
		r.WorkspaceID = types.Int64PointerValue(resp.WorkspaceID)
		r.WorkspaceName = types.StringPointerValue(resp.WorkspaceName)
		r.WorkspaceSecrets = rPriorData.WorkspaceSecrets
	}

	return diags
}
