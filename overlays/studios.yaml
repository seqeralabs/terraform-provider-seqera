overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Studios Overlay
  version: 0.0.0
actions:
  # Studios entity operations
  - target: $["paths"]["/studios"]["post"]
    update:
      x-speakeasy-entity-operation: Studios#create
  - target: $["paths"]["/studios/{sessionId}"]["get"]
    update:
      x-speakeasy-entity-operation: Studios#read
  - target: $["paths"]["/studios/{sessionId}"]["delete"]
    update:
      x-speakeasy-entity-operation: Studios#delete

  # Add retry mechanism for data studios creation
  # This handles cases where a compute environment is not ready and is in a creating state
  - target: $.paths["/studios"].post
    update:
      x-speakeasy-retries:
        strategy: backoff
        backoff:
          initialInterval: 5000 # 5 seconds
          maxInterval: 5000 # 5 seconds (fixed interval)
          maxElapsedTime: 30000 # 30 seconds
          exponent: 1.0 # No exponential backoff, fixed interval
        statusCodes:
          - 400

  # Studios parameter configurations
  - target: $["paths"]["/studios/{sessionId}"]["get"]["parameters"][0]
    update:
      x-speakeasy-param-optional: true
  - target: $["paths"]["/studios/{sessionId}"]["delete"]["parameters"][0]
    update:
      x-speakeasy-param-optional: true

  # Studios entity schema annotations
  - target: $["components"]["schemas"]["DataStudioConfiguration"]
    update:
      x-speakeasy-entity: Studios
      x-speakeasy-entity-description: |
        Studios is a unified platform where you can host a combination of
        container images and compute environments for interactive analysis using
        your preferred tools, like JupyterLab, an R-IDE, Visual Studio Code IDEs,
        or Xpra remote desktops. Each Studio session is an individual interactive
        environment that encapsulates the live environment for dynamic data analysis.

        Note:
        On Seqera Cloud, the free tier permits only one running Studio session at a time.
        To run simultaneous sessions, contact Seqera for a Seqera Cloud Pro license.


  - target: $["components"]["schemas"]["DataStudioCreateRequest"]
    update:
      x-speakeasy-entity: Studios
      x-speakeasy-entity-description: |
        Studios is a unified platform where you can host a combination of
        container images and compute environments for interactive analysis using
        your preferred tools, like JupyterLab, an R-IDE, Visual Studio Code IDEs,
        or Xpra remote desktops. Each Studio session is an individual interactive
        environment that encapsulates the live environment for dynamic data analysis.

        Note:
        On Seqera Cloud, the free tier permits only one running Studio session at a time.
        To run simultaneous sessions, contact Seqera for a Seqera Cloud Pro license.
  - target: $["components"]["schemas"]["DataStudioDto"]
    update:
      x-speakeasy-entity: Studios

  # DataStudioDto property configurations
  - target: $["components"]["schemas"]["DataStudioDto"]["properties"]["sessionId"]
    update:
      x-speakeasy-param-readonly: true
  - target: $["components"]["schemas"]["DataStudioDto"]["properties"]["sessionId"]
    update:
      x-speakeasy-name-override: sessionId

  # DataStudioCreateRequest parameter configuration
  - target: $.components.schemas.DataStudioCreateRequest.properties.sessionId
    update:
      x-speakeasy-param-optional: true

  # Remove environment property
  - target: $["components"]["schemas"]["DataStudioConfiguration"]["properties"]["environment"]
    remove: true
  - target: $["components"]["schemas"]["DataStudioDto"]["properties"]["sessionId"]
    update:
      x-speakeasy-param-optional: true

  # Add retry mechanism for studios deletion when studio needs to be stopped first
  - target: $.paths["/studios/{sessionId}"].delete
    update:
      x-speakeasy-retries:
        strategy: backoff
        backoff:
          initialInterval: 3000
          maxInterval: 10000
          maxElapsedTime: 30000
          exponent: 1.5
        statusCodes:
          - 400

  # Add custom error mapping for better user experience
  - target: $.paths["/studios/{sessionId}"].delete.responses["400"]
    update:
      description: "Bad Request - Studio must be stopped, errored, or build failed before deletion"

  # Request examples for Studios
  - target: $.components.schemas.DataStudioCreateRequest.properties.name
    update:
      example: "my-jupyter-studio"
  - target: $.components.schemas.DataStudioCreateRequest.properties.description
    update:
      example: "Jupyter studio for data analysis and visualization"
  - target: $.components.schemas.DataStudioCreateRequest.properties.dataStudioToolUrl
    update:
      example: "public.cr.seqera.io/platform/data-studio-jupyter:4.2.5-0.8"
  - target: $.components.schemas.DataStudioCreateRequest.properties.computeEnvId
    update:
      example: "compute-env-id"

  # Schema description
  - target: $.components.schemas.DataStudioDto
    update:
      description: |
        Represents a Studio session for interactive data analysis.
        Contains configuration and runtime information for Jupyter-based
        computational environments.

  # Field descriptions for DataStudioDto
  - target: $.components.schemas.DataStudioDto.properties.sessionId
    update:
      description: Unique identifier for the Studio session
  - target: $.components.schemas.DataStudioDto.properties.workspaceId
    update:
      description: Numeric identifier of the workspace containing the Studio
  - target: $.components.schemas.DataStudioDto.properties.parentCheckpoint
    update:
      description: Reference to the parent checkpoint for session restoration
  - target: $.components.schemas.DataStudioDto.properties.user
    update:
      description: User information for the Studio session owner
  - target: $.components.schemas.DataStudioDto.properties.name
    update:
      description: Display name for the Studio session
  - target: $.components.schemas.DataStudioDto.properties.description
    update:
      description: Description of the Studio session's purpose
  - target: $.components.schemas.DataStudioDto.properties.studioUrl
    update:
      description: URL to access the running Studio instance
  - target: $.components.schemas.DataStudioDto.properties.computeEnv
    update:
      description: Compute environment configuration for the Studio
