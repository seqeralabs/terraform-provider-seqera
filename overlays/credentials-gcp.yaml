overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: GCP Credentials Overlay
  version: 0.0.0

# ==============================================================================
# GOOGLE CLOUD (GCP) CREDENTIALS RESOURCE OVERLAY
# ==============================================================================
#
# Google Cloud credentials store authentication information for accessing GCP
# services within Seqera Platform workflows. Uses GCP service account keys in
# JSON format for secure authentication.
#
# AUTHENTICATION METHOD:
# ----------------------
# Service Account Key (JSON):
#   - Complete service account key JSON from GCP Console
#   - Includes project_id, private_key, client_email, etc.
#   - Sensitive data stored securely (write-only)
#
# VALIDATION RULES:
# -----------------
# - name: 2-99 alphanumeric characters with dashes/underscores (no spaces)
# - key: Valid JSON containing required service account fields
#   Required JSON fields: type, project_id, private_key_id, private_key,
#   client_email, client_id, auth_uri, token_uri
#
# TERRAFORM EXAMPLES:
# -------------------
#
# Example 1: GCP credentials with service account key (most common)
# resource "seqera_google_credential" "basic" {
#   name         = "gcp-main"
#   workspace_id = seqera_workspace.main.id
#
#   key = var.gcp_service_account_key
# }
#
# Example 2: Using file() function to load key from file
# resource "seqera_google_credential" "from_file" {
#   name         = "gcp-from-file"
#   workspace_id = seqera_workspace.main.id
#
#   key = file("${path.module}/service-account-key.json")
# }
#
# ==============================================================================

actions:
- target: $.paths
  update:
    /credentials#google:
      post:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: GoogleCredential#create
        x-speakeasy-name-override: CreateGoogleCredentials
        summary: Create Google credentials
        description: Creates new Google credentials in a user context. Append `?workspaceId` to create the credentials in
          a workspace context.
        tags:
        - credentials
        operationId: CreateGoogleCredentials
        parameters:
        - name: workspaceId
          in: query
          description: Workspace numeric identifier where the credentials will be stored
          schema:
            type: integer
            format: int64
        requestBody:
          description: Google credentials create request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateGoogleCredentialsRequest'
          required: true
        responses:
          '200':
            description: OK
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/CreateGoogleCredentialsResponse'
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
          '409':
            description: Conflict - resource already exists
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
        security:
        - BearerAuth: []
    /credentials/{credentialsId}#google:
      get:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: GoogleCredential#read
        x-speakeasy-name-override: DescribeGoogleCredentials
        summary: Describe Google credentials
        description: Retrieves the details of the Google credentials identified by the given `credentialsId`.
        tags:
        - credentials
        operationId: DescribeGoogleCredentials
        parameters:
        - name: credentialsId
          in: path
          description: Credentials string identifier
          required: true
          schema:
            type: string
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        responses:
          '200':
            description: OK
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/DescribeGoogleCredentialsResponse'
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
          '404':
            description: Not Found - Credential does not exist or has been deleted
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
        security:
        - BearerAuth: []
      put:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: GoogleCredential#update
        x-speakeasy-name-override: UpdateGoogleCredentials
        summary: Update Google credentials
        description: Updates the details of the Google credentials identified by the given `credentialsId`.
        tags:
        - credentials
        operationId: UpdateGoogleCredentials
        parameters:
        - name: credentialsId
          in: path
          description: Credentials string identifier
          required: true
          schema:
            type: string
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        requestBody:
          description: Google credentials update request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateGoogleCredentialsRequest'
          required: true
        responses:
          '204':
            description: OK - No content
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
        security:
        - BearerAuth: []
      delete:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: GoogleCredential#delete
        x-speakeasy-name-override: DeleteGoogleCredentials
        summary: Delete Google credentials
        description: Deletes the Google credentials identified by the given `credentialsId`.
        tags:
        - credentials
        operationId: DeleteGoogleCredentials
        parameters:
        - name: credentialsId
          in: path
          description: Credentials string identifier
          required: true
          schema:
            type: string
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        - name: checked
          in: query
          description: If set credentials deletion will be blocked by running jobs that depend on them
          schema:
            type: boolean
        responses:
          '204':
            description: OK - No content
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
          '409':
            description: Running jobs block the deletion of this credentials
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/DeleteCredentialsConflictResponse'
        security:
        - BearerAuth: []
- target: $.components.schemas
  update:
    GoogleCredential:
      required:
      - name
      - keys
      type: object
      properties:
        credentials_id:
          type: string
          description: Unique identifier for the credential (max 22 characters)
          x-speakeasy-param-readonly: true
          x-speakeasy-param-suppress-computed-diff: true
        name:
          minLength: 2
          maxLength: 99
          type: string
          pattern: '^[a-zA-Z0-9_-]+$'
          description: Display name for the credential. Must be 2-99 characters using only letters, numbers, underscores, and hyphens. No spaces allowed.
          x-speakeasy-param-force-new: true
        provider:
          type: string
          enum:
          - google
          default: google
          description: Cloud provider type (automatically set to "google")
          x-speakeasy-name-override: providerType
          x-speakeasy-param-readonly: true
        deleted:
          type: boolean
          description: Flag indicating if the credential has been soft-deleted
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        lastUsed:
          type: string
          format: date-time
          description: Timestamp when the credential was last used
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        dateCreated:
          type: string
          format: date-time
          description: Timestamp when the credential was created
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        lastUpdated:
          type: string
          format: date-time
          description: Timestamp when the credential was last updated
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        keys:
          x-speakeasy-entity: GoogleCredential
          x-speakeasy-entity-description: 'Manage Google credentials in Seqera platform using this resource.


            Google credentials store authentication information for accessing Google Cloud services

            within the Seqera Platform workflows.

            '
          type: object
          required:
          - data
          properties:
            data:
              type: string
              description: Google Cloud service account key JSON (required, sensitive).
              x-speakeasy-param-sensitive: true
              x-speakeasy-terraform-write-only: true
              example: "{\n  \"type\": \"service_account\",\n  \"project_id\": \"my-project\",\n  \"private_key_id\": \"key-id\"\
                ,\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\",\n  \"client_email\"\
                : \"service-account@my-project.iam.gserviceaccount.com\",\n  \"client_id\": \"123456789\",\n  \"auth_uri\"\
                : \"https://accounts.google.com/o/oauth2/auth\",\n  \"token_uri\": \"https://oauth2.googleapis.com/token\"\
                \n}\n"
    CreateGoogleCredentialsRequest:
      type: object
      required:
      - credentials
      properties:
        credentials:
          $ref: '#/components/schemas/GoogleCredential'
    CreateGoogleCredentialsResponse:
      type: object
      properties:
        credentialsId:
          type: string
    UpdateGoogleCredentialsRequest:
      type: object
      required:
      - credentials
      properties:
        credentials:
          $ref: '#/components/schemas/GoogleCredential'
    DescribeGoogleCredentialsResponse:
      type: object
      properties:
        credentials:
          $ref: '#/components/schemas/GoogleCredential'
- target: $.components.schemas.GoogleCredential.properties.description
  remove: true
- target: $.components.schemas.GoogleCredential.properties.baseUrl
  remove: true
- target: $.components.schemas.GoogleCredential.properties.category
  remove: true
- target: $["paths"]["/credentials/{credentialsId}#google"]["delete"]["parameters"][?(@.name == "checked")]
  remove: true
- target: $.components.schemas.GoogleCredential.properties.keys.properties.data
  update:
    writeOnly: true
# Add fake keyType field for generation but hide from Terraform schema
- target: $.components.schemas.GoogleCredential.properties.keys.properties
  update:
    keyType:
      type: string
      description: Type of key (always "google") - not exposed in Terraform
      default: google
      x-speakeasy-param-readonly: true
      x-speakeasy-param-computed: true
      x-speakeasy-terraform-ignore: true
- target: $["paths"]["/credentials#google"]["post"]["parameters"][?(@.name == "workspaceId")]
  update:
    x-speakeasy-param-force-new: true
