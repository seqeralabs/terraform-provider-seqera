overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: SSH Credentials Overlay
  version: 0.0.1
actions:
  - target: $.paths
    update:
      "/credentials#ssh":
        post:
          x-speakeasy-entity-operation: SSHCredential#create
          x-speakeasy-name-override: CreateSSHCredentials
          summary: Create SSH credentials
          description:
            Creates new SSH credentials in a user context. Append `?workspaceId`
            to create the credentials in a workspace context.
          tags:
            - credentials
          operationId: CreateSSHCredentials
          parameters:
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          requestBody:
            description: SSH credentials create request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/CreateSSHCredentialsRequest"
            required: true
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/CreateSSHCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []

      "/credentials/{credentialsId}#ssh":
        get:
          x-speakeasy-entity-operation: SSHCredential#read
          x-speakeasy-name-override: DescribeSSHCredentials
          summary: Describe SSH credentials
          description:
            Retrieves the details of the SSH credentials identified by the given
            `credentialsId`.
          tags:
            - credentials
          operationId: DescribeSSHCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DescribeSSHCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
            "404":
              description: Not Found - Credential does not exist or has been deleted
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
          security:
            - BearerAuth: []
        put:
          x-speakeasy-entity-operation: SSHCredential#update
          x-speakeasy-name-override: UpdateSSHCredentials
          summary: Update SSH credentials
          description:
            Updates the details of the SSH credentials identified by the given
            `credentialsId`.
          tags:
            - credentials
          operationId: UpdateSSHCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          requestBody:
            description: SSH credentials update request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/UpdateSSHCredentialsRequest"
            required: true
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []
        delete:
          x-speakeasy-entity-operation: SSHCredential#delete
          x-speakeasy-name-override: DeleteSSHCredentials
          summary: Delete SSH credentials
          description: Deletes the SSH credentials identified by the given `credentialsId`.
          tags:
            - credentials
          operationId: DeleteSSHCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []

  - target: $.components.schemas
    update:
      # SSH-specific credential schema with hoisted keys
      SSHCredential:
        required:
          - name
          - keys
        type: object
        properties:
          id:
            type: string
            description: Unique identifier for the credential (max 22 characters)
            x-speakeasy-name-override: credentialsId
            x-speakeasy-param-readonly: true
          name:
            maxLength: 100
            type: string
            description: Display name for the credential (max 100 characters)
            x-speakeasy-param-force-new: true
          provider:
            type: string
            enum: [ssh]
            default: ssh
            description: Cloud provider type (automatically set to "ssh")
            x-speakeasy-name-override: providerType
            x-speakeasy-param-readonly: true
          deleted:
            type: boolean
            description: Flag indicating if the credential has been soft-deleted
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          lastUsed:
            type: string
            format: date-time
            description: Timestamp when the credential was last used
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          dateCreated:
            type: string
            format: date-time
            description: Timestamp when the credential was created
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          lastUpdated:
            type: string
            format: date-time
            description: Timestamp when the credential was last updated
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          keys:
            x-speakeasy-entity: SSHCredential
            x-speakeasy-entity-description: |
              Manage SSH credentials in Seqera platform using this resource.

              SSH credentials store SSH private keys for secure access to remote
              compute environments and resources within the Seqera Platform workflows.
            type: object
            required:
              - privateKey
            properties:
              privateKey:
                type: string
                description: "SSH private key content (required, sensitive). The content of the private key file from the SSH asymmetrical key pair. Generate with: ssh-keygen"
                x-speakeasy-param-sensitive: true
                x-speakeasy-param-computed: false
                x-speakeasy-name-override: private_key
              passphrase:
                type: string
                description: Passphrase associated with the SSH private key (optional, sensitive). Leave empty if no passphrase is needed.
                x-speakeasy-param-sensitive: true
                x-speakeasy-param-computed: false

      # SSH-specific request/response schemas
      CreateSSHCredentialsRequest:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/SSHCredential"

      CreateSSHCredentialsResponse:
        type: object
        properties:
          credentialsId:
            type: string

      UpdateSSHCredentialsRequest:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/SSHCredential"

      DescribeSSHCredentialsResponse:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/SSHCredential"

  # ============================================================================
  # CLEANUP - Remove unused fields
  # ============================================================================

  # Remove description field (not used in web UI)
  - target: $.components.schemas.SSHCredential.properties.description
    remove: true

  # Remove category field (not used in web UI)
  - target: $.components.schemas.SSHCredential.properties.category
    remove: true

  # ============================================================================
  # SECURITY - Add writeOnly properties to sensitive fields
  # ============================================================================

  # Mark privateKey as writeOnly (never returned in API responses)
  - target: $.components.schemas.SSHCredential.properties.keys.properties.privateKey
    update:
      writeOnly: true

  # Mark passphrase as writeOnly (never returned in API responses)
  - target: $.components.schemas.SSHCredential.properties.keys.properties.passphrase
    update:
      writeOnly: true
