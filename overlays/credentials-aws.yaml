overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: AWS Credentials Overlay
  version: 0.0.1

# ==============================================================================
# AWS CREDENTIALS RESOURCE OVERLAY
# ==============================================================================
#
# AWS credentials store authentication information for accessing AWS services
# within Seqera Platform workflows. Supports both IAM user credentials (access
# keys) and IAM role assumption for secure, temporary access.
#
# AUTHENTICATION METHODS:
# -----------------------
# 1. Access Keys (access_key + secret_key):
#    - Standard IAM user credentials
#    - Long-lived access keys (AKIA prefix)
#    - Temporary security credentials (ASIA prefix)
#
# 2. IAM Role Assumption (assume_role_arn):
#    - Cross-account access via role assumption
#    - Enhanced security with temporary credentials
#    - No long-lived keys stored
#
# VALIDATION RULES:
# -----------------
# - name: 2-99 alphanumeric characters with dashes/underscores (no spaces)
# - access_key: Must start with AKIA (standard) or ASIA (temporary)
# - secret_key: Minimum 40 characters (write-only, sensitive)
# - assume_role_arn: Format: arn:aws:iam::ACCOUNT_ID:role/ROLE_NAME
# - Either (access_key AND secret_key) OR assume_role_arn must be provided
#
# TERRAFORM EXAMPLES:
# -------------------
#
# Example 1: AWS credentials with access keys (most common)
# resource "seqera_aws_credential" "with_keys" {
#   name         = "aws-with-keys"
#   workspace_id = seqera_workspace.main.id
#
#   access_key = var.aws_access_key_id
#   secret_key = var.aws_secret_access_key
# }
#
# Example 2: AWS credentials with IAM role assumption (recommended)
# resource "seqera_aws_credential" "with_assume_role" {
#   name         = "aws-with-role"
#   workspace_id = seqera_workspace.main.id
#
#   assume_role_arn = "arn:aws:iam::123456789012:role/SeqeraExecutionRole"
# }
#
# Example 3: Using both access keys and role assumption
# resource "seqera_aws_credential" "with_keys_and_role" {
#   name         = "aws-with-keys-and-role"
#   workspace_id = seqera_workspace.main.id
#
#   access_key      = var.aws_access_key_id
#   secret_key      = var.aws_secret_access_key
#   assume_role_arn = "arn:aws:iam::123456789012:role/SeqeraExecutionRole"
# }
#
# ==============================================================================

actions:
- target: $.paths
  update:
    /credentials#aws:
      post:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: AWSCredential#create
        x-speakeasy-name-override: CreateAWSCredentials
        summary: Create AWS credentials
        description: Creates new AWS credentials in a user context. Append `?workspaceId` to create the credentials in a workspace
          context.
        tags:
        - credentials
        operationId: CreateAWSCredentials
        parameters:
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        requestBody:
          description: AWS credentials create request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAWSCredentialsRequest'
          required: true
        responses:
          '200':
            description: OK
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/CreateAWSCredentialsResponse'
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
          '409':
            description: Conflict - resource already exists
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
        security:
        - BearerAuth: []
    /credentials/{credentialsId}#aws:
      get:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: AWSCredential#read
        x-speakeasy-name-override: DescribeAWSCredentials
        summary: Describe AWS credentials
        description: Retrieves the details of the AWS credentials identified by the given `credentialsId`.
        tags:
        - credentials
        operationId: DescribeAWSCredentials
        parameters:
        - name: credentialsId
          in: path
          description: Credentials string identifier
          required: true
          schema:
            type: string
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        responses:
          '200':
            description: OK
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/DescribeAWSCredentialsResponse'
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
          '404':
            description: Not Found - Credential does not exist or has been deleted
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
        security:
        - BearerAuth: []
      put:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: AWSCredential#update
        x-speakeasy-name-override: UpdateAWSCredentials
        summary: Update AWS credentials
        description: Updates the details of the AWS credentials identified by the given `credentialsId`.
        tags:
        - credentials
        operationId: UpdateAWSCredentials
        parameters:
        - name: credentialsId
          in: path
          description: Credentials string identifier
          required: true
          schema:
            type: string
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        requestBody:
          description: AWS credentials update request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateAWSCredentialsRequest'
          required: true
        responses:
          '204':
            description: OK - No content
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
        security:
        - BearerAuth: []
      delete:
        x-speakeasy-entity-operation:

          terraform-datasource: null

          terraform-resource: AWSCredential#delete
        x-speakeasy-name-override: DeleteAWSCredentials
        summary: Delete AWS credentials
        description: Deletes the AWS credentials identified by the given `credentialsId`.
        tags:
        - credentials
        operationId: DeleteAWSCredentials
        parameters:
        - name: credentialsId
          in: path
          description: Credentials string identifier
          required: true
          schema:
            type: string
        - name: workspaceId
          in: query
          description: Workspace numeric identifier
          schema:
            type: integer
            format: int64
        - name: checked
          in: query
          description: If set credentials deletion will be blocked by running jobs that depend on them
          schema:
            type: boolean
        responses:
          '204':
            description: OK - No content
          '400':
            description: Bad request
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '403':
            description: Operation not allowed
          '409':
            description: Running jobs block the deletion of this credentials
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/DeleteCredentialsConflictResponse'
        security:
        - BearerAuth: []
- target: $.components.schemas
  update:
    AWSCredential:
      required:
      - name
      - keys
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the credential (max 22 characters)
          x-speakeasy-param-readonly: true
          x-speakeasy-param-suppress-computed-diff: true
        name:
          minLength: 2
          maxLength: 99
          type: string
          pattern: '^[a-zA-Z0-9_-]+$'
          description: Display name for the credential. Must be 2-99 characters using only letters, numbers, underscores, and hyphens. No spaces allowed.
          x-speakeasy-param-force-new: true
        provider:
          type: string
          enum:
          - aws
          default: aws
          description: Cloud provider type (automatically set to "aws")
          x-speakeasy-name-override: providerType
          x-speakeasy-param-readonly: true
        deleted:
          type: boolean
          description: Flag indicating if the credential has been soft-deleted
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        lastUsed:
          type: string
          format: date-time
          description: Timestamp when the credential was last used
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        dateCreated:
          type: string
          format: date-time
          description: Timestamp when the credential was created
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        lastUpdated:
          type: string
          format: date-time
          description: Timestamp when the credential was last updated
          x-speakeasy-param-readonly: true
          x-speakeasy-terraform-ignore: true
        keys:
          x-speakeasy-entity: AWSCredential
          x-speakeasy-entity-description: 'Manage AWS credentials in Seqera platform using this resource.


            AWS credentials store authentication information for accessing AWS services

            within the Seqera Platform workflows.

            '
          type: object
          properties:
            accessKey:
              type: string
              minLength: 16
              maxLength: 128
              pattern: ^(AKIA|ASIA|AIDA)[A-Z0-9]{16,}$
              description: AWS access key ID. Must start with AKIA (standard) or ASIA (temporary). Required unless assume_role_arn is provided.
              example: AKIAIOSFODNN7EXAMPLE
              x-speakeasy-param-computed: false
              x-speakeasy-param-optional: true
              x-speakeasy-name-override: access_key
              x-speakeasy-plan-validators: AWSCredentialKeysValidator
            secretKey:
              type: string
              minLength: 40
              description: AWS secret access key (sensitive). Must be at least 40 characters. Required unless assume_role_arn is provided.
              x-speakeasy-param-sensitive: true
              x-speakeasy-param-computed: false
              x-speakeasy-param-optional: true
              example: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
              x-speakeasy-name-override: secret_key
              x-speakeasy-plan-validators: AWSCredentialKeysValidator
            assumeRoleArn:
              type: string
              pattern: ^arn:aws:iam::[0-9]{12}:role/.+$
              description: 'IAM role ARN to assume. Format: arn:aws:iam::ACCOUNT_ID:role/ROLE_NAME. Either this or both access_key and secret_key must be provided.'
              example: arn:aws:iam::123456789012:role/SeqeraRole
              x-speakeasy-param-computed: false
              x-speakeasy-param-optional: true
              x-speakeasy-name-override: assume_role_arn
              x-speakeasy-plan-validators: AWSCredentialKeysValidator
    CreateAWSCredentialsRequest:
      type: object
      properties:
        credentials:
          $ref: '#/components/schemas/AWSCredential'
    CreateAWSCredentialsResponse:
      type: object
      properties:
        credentialsId:
          type: string
    UpdateAWSCredentialsRequest:
      type: object
      properties:
        credentials:
          $ref: '#/components/schemas/AWSCredential'
    DescribeAWSCredentialsResponse:
      type: object
      properties:
        credentials:
          $ref: '#/components/schemas/AWSCredential'
- target: $.components.schemas.AWSCredential.properties.description
  remove: true
- target: $.components.schemas.AWSCredential.properties.baseUrl
  remove: true
- target: $.components.schemas.AWSCredential.properties.category
  remove: true
- target: $["paths"]["/credentials/{credentialsId}#aws"]["delete"]["parameters"][?(@.name == "checked")]
  remove: true
- target: $.components.schemas.AWSCredential.properties.keys.properties.secretKey
  update:
    writeOnly: true
- target: $.components.schemas.AWSCredential.properties.keys.properties.assumeRoleArn
  update:
    writeOnly: true
- target: $["paths"]["/credentials#aws"]["post"]["parameters"][?(@.name == "workspaceId")]
  update:
    x-speakeasy-param-force-new: true
