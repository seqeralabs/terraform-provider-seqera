overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Retry mechanism overlays for Seqera API
  version: 0.0.0
actions:
  ####################################################################
  ####              Compute Environment Retry Configuration        ####
  ####################################################################
  # Add retry mechanism for compute environment creation
  - target: $.paths["/compute-envs"].post
    update:
      x-speakeasy-retries:
        strategy: backoff
        backoff:
          initialInterval: 5000 # 5 seconds
          maxInterval: 5000 # 5 seconds (fixed interval)
          maxElapsedTime: 30000 # 30 seconds
          exponent: 1.0 # No exponential backoff, fixed interval
        statusCodes:
          - 4XX
          - 5XX

  ####################################################################
  ####                Workflow Retry Configuration                 ####
  ####################################################################
  # Add retry mechanism for workflow launch with shorter intervals for 400 errors, this is to handle if a compute environment is not ready and is in a creating state
  - target: $.paths["/workflow/launch"].post
    update:
      x-speakeasy-retries:
        strategy: backoff
        backoff:
          initialInterval: 5000 # 5 seconds
          maxInterval: 5000 # 5 seconds (fixed interval)
          maxElapsedTime: 30000 # 30 seconds
          exponent: 1.0 # No exponential backoff, fixed interval
        statusCodes:
          - 400

  ####################################################################
  ####                Data Studios Retry Configuration             ####
  ####################################################################
  # Add retry mechanism for data studios creation with same config as workflows, this is to handle if a compute environment is not ready and is in a creating state
  - target: $.paths["/studios"].post
    update:
      x-speakeasy-retries:
        strategy: backoff
        backoff:
          initialInterval: 5000 # 5 seconds
          maxInterval: 5000 # 5 seconds (fixed interval)
          maxElapsedTime: 30000 # 30 seconds
          exponent: 1.0 # No exponential backoff, fixed interval
        statusCodes:
          - 400
