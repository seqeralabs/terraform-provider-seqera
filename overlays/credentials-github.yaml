overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: GitHub Credentials Overlay
  version: 0.0.1
actions:
  - target: $.paths
    update:
      "/credentials#github":
        post:
          x-speakeasy-entity-operation: GithubCredential#create
          x-speakeasy-name-override: CreateGithubCredentials
          summary: Create GitHub credentials
          description:
            Creates new GitHub credentials in a user context. Append `?workspaceId`
            to create the credentials in a workspace context.
          tags:
            - credentials
          operationId: CreateGithubCredentials
          parameters:
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          requestBody:
            description: GitHub credentials create request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/CreateGithubCredentialsRequest"
            required: true
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/CreateGithubCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []

      "/credentials/{credentialsId}#github":
        get:
          x-speakeasy-entity-operation: GithubCredential#read
          x-speakeasy-name-override: DescribeGithubCredentials
          summary: Describe GitHub credentials
          description:
            Retrieves the details of the GitHub credentials identified by the given
            `credentialsId`.
          tags:
            - credentials
          operationId: DescribeGithubCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DescribeGithubCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []
        put:
          x-speakeasy-entity-operation: GithubCredential#update
          x-speakeasy-name-override: UpdateGithubCredentials
          summary: Update GitHub credentials
          description:
            Updates the details of the GitHub credentials identified by the given
            `credentialsId`.
          tags:
            - credentials
          operationId: UpdateGithubCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          requestBody:
            description: GitHub credentials update request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/UpdateGithubCredentialsRequest"
            required: true
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []
        delete:
          x-speakeasy-entity-operation: GithubCredential#delete
          x-speakeasy-name-override: DeleteGithubCredentials
          summary: Delete GitHub credentials
          description: Deletes the GitHub credentials identified by the given `credentialsId`.
          tags:
            - credentials
          operationId: DeleteGithubCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []

  - target: $.components.schemas
    update:
      # GitHub-specific credential schema with hoisted keys
      GithubCredential:
        required:
          - name
          - keys
        type: object
        properties:
          id:
            type: string
            description: Unique identifier for the credential (max 22 characters)
            x-speakeasy-name-override: credentialsId
            x-speakeasy-param-readonly: true
          name:
            maxLength: 100
            type: string
            description: Display name for the credential (max 100 characters)
            x-speakeasy-param-force-new: true
          provider:
            type: string
            enum: [github]
            default: github
            description: Cloud provider type (automatically set to "github")
            x-speakeasy-name-override: providerType
            x-speakeasy-param-readonly: true
          deleted:
            type: boolean
            description: Flag indicating if the credential has been soft-deleted
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          lastUsed:
            type: string
            format: date-time
            description: Timestamp when the credential was last used
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          dateCreated:
            type: string
            format: date-time
            description: Timestamp when the credential was created
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          lastUpdated:
            type: string
            format: date-time
            description: Timestamp when the credential was last updated
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          keys:
            x-speakeasy-entity: GithubCredential
            x-speakeasy-terraform-resource-name: github_credential
            x-speakeasy-entity-description: |
              Manage GitHub credentials in Seqera platform using this resource.

              GitHub credentials store authentication information for accessing GitHub
              repositories within the Seqera Platform workflows.
            type: object
            required:
              - accessToken
            properties:
              accessToken:
                type: string
                description: GitHub Personal Access Token (PAT) for authentication (required, sensitive)
                x-speakeasy-param-sensitive: true
                x-speakeasy-param-computed: false
                example: "ghp_1234567890abcdefghijklmnopqrstuvwxyz"
                x-speakeasy-name-override: access_token
              baseUrl:
                type: string
                description: "Repository base URL for GitHub Enterprise Server (optional). Leave empty for GitHub.com. Example: https://github.mycompany.com"
                example: "https://github.mycompany.com"
                x-speakeasy-param-computed: false
                x-speakeasy-name-override: base_url

      # GitHub-specific request/response schemas
      CreateGithubCredentialsRequest:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/GithubCredential"

      CreateGithubCredentialsResponse:
        type: object
        properties:
          credentialsId:
            type: string

      UpdateGithubCredentialsRequest:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/GithubCredential"

      DescribeGithubCredentialsResponse:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/GithubCredential"

  # ============================================================================
  # CLEANUP - Remove unused fields
  # ============================================================================

  # Remove description field (not used in web UI)
  - target: $.components.schemas.GithubCredential.properties.description
    remove: true

  # Remove baseUrl field from root (it's in keys)
  - target: $.components.schemas.GithubCredential.properties.baseUrl
    remove: true

  # Remove category field (not used in web UI)
  - target: $.components.schemas.GithubCredential.properties.category
    remove: true

  # Remove username field (not needed, PAT contains identity)
  - target: $.components.schemas.GithubCredential.properties.keys.properties.username
    remove: true

  # Remove password field (use access token instead)
  - target: $.components.schemas.GithubCredential.properties.keys.properties.password
    remove: true

  # ============================================================================
  # SECURITY - Add writeOnly properties to sensitive fields
  # ============================================================================

  # Mark accessToken as writeOnly (never returned in API responses)
  - target: $.components.schemas.GithubCredential.properties.keys.properties.accessToken
    update:
      writeOnly: true

  # Mark baseUrl as writeOnly (not returned in API responses)
  - target: $.components.schemas.GithubCredential.properties.keys.properties.baseUrl
    update:
      writeOnly: true
