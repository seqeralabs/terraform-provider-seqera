overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Overlay seqera-api-latest.yml => seqera-final.yaml
  version: 0.0.0
actions:

  - target: $.components.schemas.CreateComputeEnvRequest
    update:
      required:
          - computeEnv
          - credentialsId
          - config
          - name
          - platform

  - target: $.components.schemas.ComputeEnv_ComputeConfig_
    update:
      required:
        - credentialsId

  - target: $.components.schemas.CreateActionRequest
    update:
      required:
        - name
        - source
        - launch

  - target: $.components.schemas.SubmitWorkflowLaunchRequest
    update:
      required:
          - launch

  - target: $.components.schemas.WorkflowLaunchRequest
    update:
      required:
          - pipeline
          - computeEnvId
          - workDir

  # - target: $.components.schemas.ComputeEnv_ComputeConfig_
  #   update:
  #     required:
  #     - workspaceId
  #     - credentialsId

    # Compute config platform-specific schemas
  - target: $.components.schemas.AwsBatchConfig
    update:
      required:
          - region

  - target: $.components.schemas.ForgeConfig
    update:
      required:
        - type
        - minCpus
        - maxCpus

  - target: $.components.schemas.AwsCloudConfig
    update:
      required:
        - region

  - target: $.components.schemas.AzBatchConfig
    update:
      required:
        - region

  - target: $.components.schemas.AzBatchForgeConfig
    update:
      required:
        - vmCount

  - target: $.components.schemas.GoogleBatchComputeConfig
    update:
      required:
        - location

  - target: $.components.schemas.K8sComputeConfig
    update:
      required:
        - server
        - namespace
        - sslCert
        - headServiceAccount
        - storageClaimName

  - target: $.components.schemas.EksComputeConfig
    update:
      required:
        - region
        - clusterName

  - target: $.components.schemas.GkeComputeConfig
    update:
      required:
        - region
        - clusterName

  - target: $.components.schemas.UnivaComputeConfig
    update:
      required:
        - workDir

  - target: $.components.schemas.SlurmComputeConfig
    update:
      required:
        - workDir

  - target: $.components.schemas.LsfComputeConfig
    update:
      required:
        - workDir

  - target: $.components.schemas.AltairPbsComputeConfig
    update:
      required:
        - workDir

  - target: $.components.schemas.MoabComputeConfig
    update:
      required:
        - workDir

  - target: $.components.schemas.LocalComputeConfig
    update:
      required:
        - workDir

  - target: $.components.schemas.SeqeraComputeConfig
    update:
      required:
        - region

    # Pipeline requests
  - target: $.components.schemas.CreatePipelineRequest
    update:
      required:
        - name
        - launch
        - workspace_id


  - target: $["components"]["schemas"]["CreateDatasetRequest"]
    update:
      x-speakeasy-entity: Datasets
      required:
        - name
  - target: $["components"]["schemas"]["CreatePipelineSecretRequest"]
    update:
      required:
        - name
        - value
        - workspace_id

  - target: $["components"]["schemas"]["Credentials"]["required"][*]
    remove: true
  - target: $["components"]["schemas"]["Credentials"]
    update:
      required:
        - name
        - provider
        - keys

  - target: $["components"]["schemas"]["DataLinkCreateRequest"]["required"][*]
    remove: true

  - target: $["components"]["schemas"]["DataLinkCreateRequest"]
    update:
      required:
        - description
        - name
        - provider
        - publicAccessible
        - resourceRef
        - type

  # Make workspaceId query parameter required for resource operations
  - target: $.paths["/actions"].post.parameters[?(@.name == "workspaceId")]
    update:
      required: true

  - target: $.paths["/compute-envs"].post.parameters[?(@.name == "workspaceId")]
    update:
      required: true

  - target: $.paths["/workflow/launch"].post.parameters[?(@.name == "workspaceId")]
    update:
      required: true
