overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Datasets Overlay
  version: 0.0.0

# ==============================================================================
# DATASETS RESOURCE OVERLAY
# ==============================================================================
#
# Datasets in Seqera are CSV (comma-separated values) and TSV (tab-separated
# values) files stored in a workspace. They are used as inputs to pipelines to
# simplify data management, minimize user data-input errors, and facilitate
# reproducible workflows.
#
# KEY CONCEPTS:
# -------------
# - Datasets belong to workspaces and must reference a workspace_id
# - Datasets store structured tabular data in CSV or TSV format
# - Used as pipeline inputs to ensure consistent, validated data
# - Support versioning for tracking data changes over time
# - Can include metadata like descriptions and media types
#
# VALIDATION RULES:
# -----------------
# - name: 1-100 characters following dataset naming conventions
# - description: Maximum 1000 characters
# - id: Maximum 22 characters
# - mediaType: Maximum 80 characters (MIME type)
#
# TERRAFORM EXAMPLES:
# -------------------
#
# Example 1: Basic dataset
# resource "seqera_datasets" "sample_data" {
#   workspace_id = seqera_workspace.my_workspace.id
#   name         = "my-dataset"
# }
#
# Example 2: Dataset with description
# resource "seqera_datasets" "genomics_samples" {
#   workspace_id = seqera_workspace.my_workspace.id
#   name         = "my-dataset"
#   description  = "Dataset containing sample genomic data"
# }
#
# ==============================================================================

actions:
  # Remove existing entity operation
  - target: $["paths"]["/datasets"]["get"]["x-speakeasy-entity-operation"]
    remove: true

  # Dataset entity operations
  - target: $["paths"]["/datasets"]["post"]
    update:
      x-speakeasy-entity-operation:

        terraform-datasource: null

        terraform-resource: Datasets#create
  - target: $["paths"]["/datasets/{datasetId}"]["put"]
    update:
      x-speakeasy-entity-operation:

        terraform-datasource: null

        terraform-resource: Dataset#update
  - target: $["paths"]["/datasets/{datasetId}"]["delete"]
    update:
      x-speakeasy-entity-operation:

        terraform-datasource: null

        terraform-resource: Dataset#delete
  - target: $["paths"]["/datasets/{datasetId}/metadata"]["get"]
    update:
      x-speakeasy-entity-operation:

        terraform-datasource: null

        terraform-resource: Dataset#read

  # Dataset entity annotation
  - target: $["components"]["schemas"]["DatasetDto"]
    update:
      x-speakeasy-entity: Datasets
      x-speakeasy-entity-description: |
        Manage datasets for storing and versioning research data.

        Datasets in Seqera are CSV (comma-separated values) and TSV
        (tab-separated values) files stored in a workspace.

        They are used as inputs to pipelines to simplify data management,
        minimize user data-input errors, and facilitate reproducible workflows.

  # Dataset parameter requirements
  - target: $["paths"]["/datasets"]["post"]["parameters"][0]
    update:
      required: true

  # Request examples for Dataset
  - target: $.components.schemas.CreateDatasetRequest.properties.name
    update:
      example: "my-dataset"
  - target: $.components.schemas.CreateDatasetRequest.properties.description
    update:
      example: "Dataset containing sample genomic data"

  # Schema description
  - target: $.components.schemas.DatasetDto
    update:
      description: |
        Represents a dataset in the Seqera Platform.
        Contains dataset metadata, versioning information, and access
        controls for data management and sharing.

  # Field descriptions for DatasetDto
  - target: $.components.schemas.DatasetDto.properties.id
    update:
      description: Unique identifier for the dataset (max 22 characters)
  - target: $.components.schemas.DatasetDto.properties.name
    update:
      description: Dataset name following naming conventions (1-100 characters)
  - target: $.components.schemas.DatasetDto.properties.description
    update:
      description: Detailed description of the dataset contents and purpose (max 1000 characters)
  - target: $.components.schemas.DatasetDto.properties.mediaType
    update:
      description: MIME type or media type of the dataset content (max 80 characters)
  - target: $.components.schemas.DatasetDto.properties.workspaceId
    update:
      description: Numeric identifier of the workspace containing this dataset

  # ============================================================================
  # CLEANUP - Remove runtime and unmanageable fields
  # ============================================================================

  # Remove user information (runtime data - who created the dataset)
  - target: $.components.schemas.DatasetDto.properties.user
    remove: true

  # Remove lastUpdatedBy (runtime data - who last modified)
  - target: $.components.schemas.DatasetDto.properties.lastUpdatedBy
    remove: true

  # Remove runsInfo (runtime statistics)
  - target: $.components.schemas.DatasetDto.properties.runsInfo
    remove: true

  # Remove labels (managed separately via label resources)
  - target: $.components.schemas.DatasetDto.properties.labels
    remove: true

  # Remove hidden (internal visibility state)
  - target: $.components.schemas.DatasetDto.properties.hidden
    remove: true

  # Remove deleted (internal deletion flag)
  - target: $.components.schemas.DatasetDto.properties.deleted
    remove: true

  # Remove organizationId (derived from workspace)
  - target: $.components.schemas.DatasetDto.properties.organizationId
    remove: true

  # Remove version (read-only internal versioning)
  - target: $.components.schemas.DatasetDto.properties.version
    remove: true

  # Remove dateCreated (use lastUpdated instead)
  - target: $.components.schemas.DatasetDto.properties.dateCreated
    remove: true

  # Mark lastUpdated as read-only
  - target: $.components.schemas.DatasetDto.properties.lastUpdated
    update:
      x-speakeasy-param-readonly: true
      description: Timestamp when the dataset was last modified
