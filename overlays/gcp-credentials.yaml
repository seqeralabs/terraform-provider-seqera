overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: GCP Credentials Overlay
  version: 0.0.0

# ==============================================================================
# GOOGLE CLOUD CREDENTIALS RESOURCE OVERLAY
# ==============================================================================
#
# Google Cloud credentials store service account keys for authenticating with
# Google Cloud Platform services in Seqera workflows. The credentials use a
# JSON service account key file containing the authentication information.
#
# TERRAFORM EXAMPLES:
# -------------------
#
# Example 1: Basic Google credentials
# resource "seqera_google_credential" "gcp" {
#   name         = "gcp-service-account"
#   workspace_id = seqera_workspace.main.id
#
#   keys = {
#     data = file("${path.module}/gcp-service-account.json")
#   }
# }
#
# Example 2: Using variable for service account key
# resource "seqera_google_credential" "gcp_prod" {
#   name         = "gcp-production"
#   workspace_id = seqera_workspace.prod.id
#
#   keys = {
#     data = var.gcp_service_account_key
#   }
# }
#
# ==============================================================================

actions:
  # ============================================================================
  # CUSTOM OPERATIONS
  # ============================================================================
  # Google credentials use virtual paths (#google) to differentiate from generic credentials

  - target: $.paths
    update:
      "/credentials#google":
        post:
          x-speakeasy-entity-operation: GoogleCredential#create
          x-speakeasy-name-override: CreateGoogleCredentials
          summary: Create Google credentials
          description: Creates new Google credentials in a user context. Append `?workspaceId` to create the credentials in a workspace context.
          tags:
          - credentials
          operationId: CreateGoogleCredentials
          parameters:
          - name: workspaceId
            in: query
            description: Workspace numeric identifier where the credentials will be stored
            schema:
              type: integer
              format: int64
          requestBody:
            description: Google credentials create request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/CreateGoogleCredentialsRequest"
            required: true
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/CreateGoogleCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
          - BearerAuth: []

      "/credentials/{credentialsId}#google":
        get:
          x-speakeasy-entity-operation: GoogleCredential#read
          x-speakeasy-name-override: DescribeGoogleCredentials
          summary: Describe Google credentials
          description: Retrieves the details of the Google credentials identified by the given `credentialsId`.
          tags:
          - credentials
          operationId: DescribeGoogleCredentials
          parameters:
          - name: credentialsId
            in: path
            description: Credentials string identifier
            required: true
            schema:
              type: string
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DescribeGoogleCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
          - BearerAuth: []
        put:
          x-speakeasy-entity-operation: GoogleCredential#update
          x-speakeasy-name-override: UpdateGoogleCredentials
          summary: Update Google credentials
          description: Updates the details of the Google credentials identified by the given `credentialsId`.
          tags:
          - credentials
          operationId: UpdateGoogleCredentials
          parameters:
          - name: credentialsId
            in: path
            description: Credentials string identifier
            required: true
            schema:
              type: string
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          requestBody:
            description: Google credentials update request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/UpdateGoogleCredentialsRequest"
            required: true
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
          - BearerAuth: []
        delete:
          x-speakeasy-entity-operation: GoogleCredential#delete
          x-speakeasy-name-override: DeleteGoogleCredentials
          summary: Delete Google credentials
          description: Deletes the Google credentials identified by the given `credentialsId`.
          tags:
          - credentials
          operationId: DeleteGoogleCredentials
          parameters:
          - name: credentialsId
            in: path
            description: Credentials string identifier
            required: true
            schema:
              type: string
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          - name: checked
            in: query
            description: If set credentials deletion will be blocked by running jobs that depend on them
            schema:
              type: boolean
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
            "409":
              description: Running jobs block the deletion of this credentials
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DeleteCredentialsConflictResponse"
          security:
          - BearerAuth: []

  # ============================================================================
  # SCHEMA CONFIGURATION
  # ============================================================================

  - target: $.components.schemas
    update:
      # Main credential schema
      GoogleCredential:
        x-speakeasy-entity: GoogleCredential
        x-speakeasy-entity-description: |
          Manage Google credentials in Seqera platform using this resource.

          Google credentials store authentication information for accessing Google Cloud services
          within the Seqera Platform workflows.
        required:
          - name
          - keys
        type: object
        properties:
          id:
            type: string
            description: Unique identifier for the credential (max 22 characters)
            x-speakeasy-name-override: credentialsId
            x-speakeasy-param-suppress-computed-diff: true
            x-speakeasy-param-readonly: true
          name:
            maxLength: 100
            type: string
            description: Display name for the credential (max 100 characters). Required.
          description:
            type: string
            description: Optional description explaining the purpose of the credential
            x-speakeasy-param-computed: false
          provider:
            type: string
            enum: [google]
            default: google
            description: Cloud provider type (automatically set to "google")
            x-speakeasy-name-override: providerType
            x-speakeasy-param-computed: true
            x-speakeasy-param-readonly: true
          baseUrl:
            type: string
            description: Base URL for the service (optional)
            x-speakeasy-param-computed: false
          category:
            type: string
            description: Category of the credential (optional)
            x-speakeasy-param-computed: false
          deleted:
            type: boolean
            description: Flag indicating if the credential has been soft-deleted
            x-speakeasy-param-suppress-computed-diff: true
            x-speakeasy-param-readonly: true
          lastUsed:
            type: string
            format: date-time
            description: Timestamp when the credential was last used by a workflow
            x-speakeasy-param-suppress-computed-diff: true
            x-speakeasy-param-readonly: true
          dateCreated:
            type: string
            format: date-time
            description: Timestamp when the credential was created
            x-speakeasy-param-suppress-computed-diff: true
            x-speakeasy-param-readonly: true
          lastUpdated:
            type: string
            format: date-time
            description: Timestamp when the credential was last updated
            x-speakeasy-param-suppress-computed-diff: true
            x-speakeasy-param-readonly: true
          keys:
            $ref: '#/components/schemas/GoogleSecurityKeys'
            description: Google service account key JSON. Required.

      # Request/Response schemas
      CreateGoogleCredentialsRequest:
        type: object
        required:
          - credentials
        properties:
          credentials:
            $ref: '#/components/schemas/GoogleCredential'

      CreateGoogleCredentialsResponse:
        type: object
        properties:
          credentialsId:
            type: string

      UpdateGoogleCredentialsRequest:
        type: object
        required:
          - credentials
        properties:
          credentials:
            $ref: '#/components/schemas/GoogleCredential'

      DescribeGoogleCredentialsResponse:
        type: object
        properties:
          credentials:
            $ref: '#/components/schemas/GoogleCredential'

  # ============================================================================
  # CLEANUP - Remove unused fields
  # ============================================================================
  # The web UI only stores name and credentials. Remove fields not supported.

  # Remove description field (not used in web UI)
  - target: $.components.schemas.GoogleCredential.properties.description
    remove: true

  # Remove baseUrl field (not used in web UI)
  - target: $.components.schemas.GoogleCredential.properties.baseUrl
    remove: true

  # Remove category field (not used in web UI)
  - target: $.components.schemas.GoogleCredential.properties.category
    remove: true

  # Remove checked parameter from delete operation (not used in web UI)
  - target: $["paths"]["/credentials/{credentialsId}#google"]["delete"]["parameters"][?(@.name == "checked")]
    remove: true

  # ============================================================================
  # FIELD CONFIGURATION - SENSITIVE DATA
  # ============================================================================

  # Mark Google service account key data as sensitive
  - target: $.components.schemas.GoogleSecurityKeys.properties.data
    update:
      x-speakeasy-param-sensitive: true
      description: Google Cloud service account key JSON (sensitive)

  # ============================================================================
  # REQUEST EXAMPLES
  # ============================================================================

  # Provide realistic example for service account key
  - target: $.components.schemas.GoogleSecurityKeys.properties.data
    update:
      example: |
        {
          "type": "service_account",
          "project_id": "my-project",
          "private_key_id": "key-id",
          "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
          "client_email": "service-account@my-project.iam.gserviceaccount.com",
          "client_id": "123456789",
          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
          "token_uri": "https://oauth2.googleapis.com/token"
        }
