overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Container Registry Credentials Overlay
  version: 0.0.1
actions:
  - target: $.paths
    update:
      "/credentials#container-registry":
        post:
          x-speakeasy-entity-operation: ContainerRegistryCredential#create
          x-speakeasy-name-override: CreateContainerRegistryCredentials
          summary: Create container registry credentials
          description:
            Creates new container registry credentials in a user context. Append `?workspaceId`
            to create the credentials in a workspace context.
          tags:
            - credentials
          operationId: CreateContainerRegistryCredentials
          parameters:
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          requestBody:
            description: Container registry credentials create request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/CreateContainerRegistryCredentialsRequest"
            required: true
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/CreateContainerRegistryCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []

      "/credentials/{credentialsId}#container-registry":
        get:
          x-speakeasy-entity-operation: ContainerRegistryCredential#read
          x-speakeasy-name-override: DescribeContainerRegistryCredentials
          summary: Describe container registry credentials
          description:
            Retrieves the details of the container registry credentials identified by the given
            `credentialsId`.
          tags:
            - credentials
          operationId: DescribeContainerRegistryCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DescribeContainerRegistryCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
            "404":
              description: Not Found - Credential does not exist or has been deleted
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
          security:
            - BearerAuth: []
        put:
          x-speakeasy-entity-operation: ContainerRegistryCredential#update
          x-speakeasy-name-override: UpdateContainerRegistryCredentials
          summary: Update container registry credentials
          description:
            Updates the details of the container registry credentials identified by the given
            `credentialsId`.
          tags:
            - credentials
          operationId: UpdateContainerRegistryCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          requestBody:
            description: Container registry credentials update request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/UpdateContainerRegistryCredentialsRequest"
            required: true
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []
        delete:
          x-speakeasy-entity-operation: ContainerRegistryCredential#delete
          x-speakeasy-name-override: DeleteContainerRegistryCredentials
          summary: Delete container registry credentials
          description: Deletes the container registry credentials identified by the given `credentialsId`.
          tags:
            - credentials
          operationId: DeleteContainerRegistryCredentials
          parameters:
            - name: credentialsId
              in: path
              description: Credentials string identifier
              required: true
              schema:
                type: string
            - name: workspaceId
              in: query
              description: Workspace numeric identifier
              schema:
                type: integer
                format: int64
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
            - BearerAuth: []

  - target: $.components.schemas
    update:
      # Container Registry-specific credential schema with hoisted keys
      ContainerRegistryCredential:
        required:
          - name
          - keys
        type: object
        properties:
          id:
            type: string
            description: Unique identifier for the credential (max 22 characters)
            x-speakeasy-name-override: credentialsId
            x-speakeasy-param-readonly: true
          name:
            maxLength: 100
            type: string
            description: Display name for the credential (max 100 characters)
            x-speakeasy-param-force-new: true
          provider:
            type: string
            enum: [container-reg]
            default: container-reg
            description: Cloud provider type (automatically set to "container-reg")
            x-speakeasy-name-override: providerType
            x-speakeasy-param-readonly: true
          deleted:
            type: boolean
            description: Flag indicating if the credential has been soft-deleted
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          lastUsed:
            type: string
            format: date-time
            description: Timestamp when the credential was last used
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          dateCreated:
            type: string
            format: date-time
            description: Timestamp when the credential was created
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          lastUpdated:
            type: string
            format: date-time
            description: Timestamp when the credential was last updated
            x-speakeasy-param-readonly: true
            x-speakeasy-terraform-ignore: true
          keys:
            x-speakeasy-entity: ContainerRegistryCredential
            x-speakeasy-entity-description: |
              Manage container registry credentials in Seqera platform using this resource.

              Container registry credentials store authentication information for accessing
              container registries (Docker Hub, ECR, GCR, ACR, etc.) within the Seqera Platform workflows.
            type: object
            required:
              - userName
              - password
            properties:
              userName:
                type: string
                description: Username for container registry authentication (required)
                example: "myuser"
                x-speakeasy-param-computed: false
                x-speakeasy-name-override: user_name
              password:
                type: string
                description: Password or access token for container registry authentication (required, sensitive)
                x-speakeasy-param-sensitive: true
                x-speakeasy-param-computed: false
                example: "mypassword"
              registry:
                type: string
                description: "Container registry server URL (optional). Examples: docker.io, gcr.io, account.dkr.ecr.region.amazonaws.com"
                example: "docker.io"
                x-speakeasy-param-computed: false

      # Container Registry-specific request/response schemas
      CreateContainerRegistryCredentialsRequest:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/ContainerRegistryCredential"

      CreateContainerRegistryCredentialsResponse:
        type: object
        properties:
          credentialsId:
            type: string

      UpdateContainerRegistryCredentialsRequest:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/ContainerRegistryCredential"

      DescribeContainerRegistryCredentialsResponse:
        type: object
        properties:
          credentials:
            $ref: "#/components/schemas/ContainerRegistryCredential"

  # ============================================================================
  # CLEANUP - Remove unused fields
  # ============================================================================

  # Remove description field (not used in web UI)
  - target: $.components.schemas.ContainerRegistryCredential.properties.description
    remove: true

  # Remove category field (not used in web UI)
  - target: $.components.schemas.ContainerRegistryCredential.properties.category
    remove: true

  # ============================================================================
  # SECURITY - Add writeOnly properties to sensitive fields
  # ============================================================================

  # Mark password as writeOnly (never returned in API responses)
  - target: $.components.schemas.ContainerRegistryCredential.properties.keys.properties.password
    update:
      writeOnly: true

  # Mark registry as writeOnly (not returned in API responses)
  - target: $.components.schemas.ContainerRegistryCredential.properties.keys.properties.registry
    update:
      writeOnly: true
