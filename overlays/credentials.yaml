overlay: 1.0.0
x-speakeasy-jsonpath: rfc9535
info:
  title: Credentials Overlay
  version: 0.0.0
actions:
  # Credentials provider enum updates (consolidated)
  - target: $["components"]["schemas"]["Credentials"]["properties"]["provider"]
    update:
      x-speakeasy-name-override: providerType
  - target: $["components"]["schemas"]["Credentials"]["properties"]["lastUsed"]
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $["components"]["schemas"]["Credentials"]["properties"]["lastUpdated"]
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $["paths"]["/credentials"]["post"]["parameters"][0]
    update:
      required: true
  - target: $["components"]["schemas"]["Credentials"]["properties"]["provider"]
    update:
      x-speakeasy-plan-validators: CredentialsConfigValidator

  # Credentials entity operations
  - target: $.paths["/credentials"].post
    update:
      x-speakeasy-entity-operation: Credential#create
  - target: $.paths["/credentials/{credentialsId}"].get
    update:
      x-speakeasy-entity-operation: Credential#read
  - target: $.paths["/credentials/{credentialsId}"].put
    update:
      x-speakeasy-entity-operation: Credential#update
  - target: $.paths["/credentials/{credentialsId}"].delete
    update:
      x-speakeasy-entity-operation: Credential#delete

  # CredentialsDto annotations
  - target: $.components.schemas.CredentialsDto.properties.id
    update:
      x-speakeasy-name-override: credentialsId
      x-speakeasy-param-suppress-computed-diff: true
  - target: $.components.schemas.CredentialsDto.properties.description
    update:
      x-speakeasy-param-computed: false
  - target: $.components.schemas.CredentialsDto.properties.provider
    update:
      x-speakeasy-param-computed: false
  - target: $.components.schemas.CredentialsDto.properties.category
    update:
      x-speakeasy-param-computed: false
  - target: $.components.schemas.CredentialsDto.properties.deleted
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $.components.schemas.CredentialsDto.properties.lastUsed
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $.components.schemas.CredentialsDto.properties.lastUpdated
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $.components.schemas.CredentialsDto.properties.dateCreated
    update:
      x-speakeasy-param-readonly: true
  - target: $.components.schemas.CredentialsDto.properties.keys
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $.components.schemas.CredentialsDto.properties.baseUrl
    update:
      x-speakeasy-param-computed: true

  # Entity annotations
  - target: $.components.schemas.CredentialsDto
    update:
      x-speakeasy-entity: Credential

  # Updated Credentials schema annotations
  - target: $["components"]["schemas"]["Credentials"]["properties"]["id"]
    update:
      x-speakeasy-name-override: credentialsId
  - target: $["components"]["schemas"]["Credentials"]["properties"]["id"]
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $["components"]["schemas"]["Credentials"]["properties"]["description"]
    update:
      x-speakeasy-param-computed: false
  - target: $["components"]["schemas"]["Credentials"]["properties"]["provider"]["enum"][*]
    remove: true
  - target: $["components"]["schemas"]["Credentials"]["properties"]["provider"]["enum"]
    update:
      - aws
      - azure
      - azure_entra
      - google
      - github
      - gitlab
      - bitbucket
      - ssh
      - k8s
      - container-reg
      - tw-agent
      - codecommit
      - gitea
      - azurerepos
      - seqeracompute
  - target: $["components"]["schemas"]["Credentials"]["properties"]["baseUrl"]
    update:
      x-speakeasy-param-computed: false
  - target: $["components"]["schemas"]["Credentials"]["properties"]["category"]
    update:
      x-speakeasy-param-computed: false
  - target: $["components"]["schemas"]["Credentials"]["properties"]["deleted"]
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $["components"]["schemas"]["Credentials"]["properties"]["dateCreated"]
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $["components"]["schemas"]["Credentials"]
    update:
      x-speakeasy-entity: Credential
      x-speakeasy-entity-description: |
        Manage workspace credentials in Seqera platform using this resource.

        Credentials store authentication information for accessing cloud providers,
        Git repositories, container registries, and other external services
        within the Seqera Platform workflows.

  # Ignore discriminator fields in all security key schemas to prevent state changes
  - target: $.components.schemas.AgentSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.AwsSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.AzureReposSecurityKeys.allOf[1].properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.AzureSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.BitBucketSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.CodeCommitSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.ContainerRegistryKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.GitHubSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.GitLabSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.GiteaSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.GoogleSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.K8sSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.SSHSecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.SecurityKeys.properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true
  - target: $.components.schemas.SeqeraComputeSecurityKeys.allOf[1].properties.discriminator
    update:
      x-speakeasy-terraform-ignore: true

  # GoogleSecurityKeys plan validator
  - target: $["components"]["schemas"]["GoogleSecurityKeys"]
    update:
      x-speakeasy-plan-validators: GoogleKeysCrdentialValidator

  # SecurityKeys configuration
  - target: $["components"]["schemas"]["SecurityKeys"]
    update:
      x-speakeasy-param-computed: false

  # GitHub security keys password configuration
  - target: $["components"]["schemas"]["GitHubSecurityKeys"]["properties"]["password"]
    update:
      x-speakeasy-param-sensitive: true
  - target: $["components"]["schemas"]["GitHubSecurityKeys"]["properties"]["password"]
    update:
      x-speakeasy-param-suppress-computed-diff: true

  # Google security keys data configuration
  - target: $["components"]["schemas"]["GoogleSecurityKeys"]["properties"]["data"]
    update:
      x-speakeasy-param-sensitive: true
  - target: $["components"]["schemas"]["GoogleSecurityKeys"]["properties"]["data"]
    update:
      x-speakeasy-param-suppress-computed-diff: true
  - target: $.paths
    update:
      "/credentials#aws":
        post:
          x-speakeasy-entity-operation: AWSCredential#create
          x-speakeasy-name-override: CreateAWSCredentials
          summary: Create AWS credentials
          description: Creates new AWS credentials in a user context. Append `?workspaceId`
            to create the credentials in a workspace context.
          tags:
          - credentials
          operationId: CreateAWSCredentials
          parameters:
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          requestBody:
            description: AWS credentials create request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/CreateAWSCredentialsRequest"
            required: true
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/CreateAWSCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
          - BearerAuth: []

      "/credentials/{credentialsId}#aws":
        get:
          x-speakeasy-entity-operation: AWSCredential#read
          x-speakeasy-name-override: DescribeAWSCredentials
          summary: Describe AWS credentials
          description: Retrieves the details of the AWS credentials identified by the given
            `credentialsId`.
          tags:
          - credentials
          operationId: DescribeAWSCredentials
          parameters:
          - name: credentialsId
            in: path
            description: Credentials string identifier
            required: true
            schema:
              type: string
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          responses:
            "200":
              description: OK
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DescribeAWSCredentialsResponse"
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
          - BearerAuth: []
        put:
          x-speakeasy-entity-operation: AWSCredential#update
          x-speakeasy-name-override: UpdateAWSCredentials
          summary: Update AWS credentials
          description: Updates the details of the AWS credentials identified by the given
            `credentialsId`.
          tags:
          - credentials
          operationId: UpdateAWSCredentials
          parameters:
          - name: credentialsId
            in: path
            description: Credentials string identifier
            required: true
            schema:
              type: string
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          requestBody:
            description: AWS credentials update request
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/UpdateAWSCredentialsRequest"
            required: true
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
          security:
          - BearerAuth: []
        delete:
          x-speakeasy-entity-operation: AWSCredential#delete
          x-speakeasy-name-override: DeleteAWSCredentials
          summary: Delete AWS credentials
          description: Deletes the AWS credentials identified by the given `credentialsId`.
          tags:
          - credentials
          operationId: DeleteAWSCredentials
          parameters:
          - name: credentialsId
            in: path
            description: Credentials string identifier
            required: true
            schema:
              type: string
          - name: workspaceId
            in: query
            description: Workspace numeric identifier
            schema:
              type: integer
              format: int64
          - name: checked
            in: query
            description: If set credentials deletion will be blocked by running jobs that
              depend on them
            schema:
              type: boolean
          responses:
            "204":
              description: OK - No content
            "400":
              description: Bad request
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/ErrorResponse"
            "403":
              description: Operation not allowed
            "409":
              description: Running jobs block the deletion of this credentials
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/DeleteCredentialsConflictResponse"
          security:
          - BearerAuth: []

      # "/credentials#azure":
      #   # Similar duplication for Azure operations

      # "/credentials/{credentialsId}#azure":
      #   # Similar duplication for Azure operations

  - target: $.components.schemas
    update:
      # AWS-specific credential schema
      AWSCredential:
        x-speakeasy-entity: AWSCredential
        x-speakeasy-entity-description: |
          Manage AWS credentials in Seqera platform using this resource.

          AWS credentials store authentication information for accessing AWS services
          within the Seqera Platform workflows.
        required:
          - name
          - provider
          - keys
        type: object
        properties:
          id:
            type: string
            description: Unique identifier for the credential (max 22 characters)
            x-speakeasy-name-override: credentialsId
            x-speakeasy-param-suppress-computed-diff: true
          name:
            maxLength: 100
            type: string
            description: Display name for the credential (max 100 characters)
          description:
            type: string
            description: Optional description explaining the purpose of the credential
            x-speakeasy-param-computed: false
          provider:
            type: string
            enum: [aws]
            description: Cloud provider type (aws)
            x-speakeasy-name-override: providerType
            x-speakeasy-param-computed: false
          baseUrl:
            type: string
            description: Base URL for the service
            x-speakeasy-param-computed: false
          category:
            type: string
            description: Category of the credential
            x-speakeasy-param-computed: false
          deleted:
            type: boolean
            description: Flag indicating if the credential has been soft-deleted
            x-speakeasy-param-suppress-computed-diff: true
          lastUsed:
            type: string
            format: date-time
            description: Timestamp when the credential was last used
            x-speakeasy-param-suppress-computed-diff: true
          dateCreated:
            type: string
            format: date-time
            description: Timestamp when the credential was created
            x-speakeasy-param-suppress-computed-diff: true
          lastUpdated:
            type: string
            format: date-time
            description: Timestamp when the credential was last updated
            x-speakeasy-param-suppress-computed-diff: true
          keys:
            $ref: '#/components/schemas/AwsSecurityKeys'
            description: AWS security keys for authentication

      # AWS-specific request/response schemas
      CreateAWSCredentialsRequest:
        type: object
        required:
          - credentials
        properties:
          credentials:
            $ref: '#/components/schemas/AWSCredentialInput'

      CreateAWSCredentialsResponse:
        type: object
        properties:
          credentialsId:
            type: string

      UpdateAWSCredentialsRequest:
        type: object
        required:
          - credentials
        properties:
          credentials:
            $ref: '#/components/schemas/AWSCredentialInput'

      DescribeAWSCredentialsResponse:
        type: object
        properties:
          credentials:
            $ref: '#/components/schemas/AWSCredential'

      # AWS credential input schema (for create/update)
      AWSCredentialInput:
        required:
          - name
          - provider
          - keys
        type: object
        properties:
          id:
            type: string
            description: Unique identifier for the credential (max 22 characters)
            x-speakeasy-name-override: credentialsId
          name:
            maxLength: 100
            type: string
            description: Display name for the credential (max 100 characters)
          description:
            type: string
            description: Optional description explaining the purpose of the credential
          provider:
            type: string
            enum: [aws]
            description: Cloud provider type (aws)
            x-speakeasy-name-override: providerType
          baseUrl:
            type: string
            description: Base URL for the service
          category:
            type: string
            description: Category of the credential
          keys:
            $ref: '#/components/schemas/AwsSecurityKeys'
            description: AWS security keys for authentication
